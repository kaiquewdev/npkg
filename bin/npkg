#!/usr/bin/env coffee

log = require 'node-log'
log.setName 'npkg'
  
nopt = require 'nopt'
path = require 'path'

known =
  in: path
  out: path

short =
  i: ['--in']
  o: ['--out']
  t: ['--arch']       
           
parsed = nopt known, short, process.argv, 2
return log.error 'Please enter all required parameters' unless parsed.in and parsed.out
  
log.info 'Starting npkg.'
  
npkg = require '../lib/main'
basedir = './temp/'

npkg.build basedir, parsed, (err) ->
  if err
    log.error 'Build failed! - Error: ' + err
    # rimraf.sync basedir
    if !(err instanceof Error)
      err = new Error err
    throw err if err
  else
    log.info 'Build completed! - Files located at ' + parsed.out
    # rimraf.sync basedir
