#!/usr/bin/env coffee

log = require 'node-log'
log.setName 'npkg'
  
nopt = require 'nopt'
path = require 'path'

known =
  in: path
  out: path
  # arch: ['windows', 'debian', 'osx']
  arch: ['debian']

short =
  i: ['--in']
  o: ['--out']
  t: ['--arch']       
           
parsed = nopt known, short, process.argv, 2
log.info 'Starting npkg. Architecture: ' + parsed.arch
  
npkg = require '../lib/main'
basedir = './temp/'

npkg.build basedir, npkg[parsed.arch], parsed, (err) ->
  if err
    log.error 'Build failed! - Error: ' + err
    # rimraf.sync basedir
    if !(err instanceof Error)
      err = new Error err
    throw err if err
  else
    log.info 'Build completed! - Files located at ' + parsed.out
    # rimraf.sync basedir
